<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Common">
    <!--车辆表使用别名 veh-->
    <sql id="userVehiclePermission">
        <choose>
            <when test=" isLeader != null and isLeader == 0 ">
                JOIN (
                SELECT
                uv.vehicle_id AS vehId
                FROM
                sys_user_vehicle_lk uv
                WHERE
                uv.user_id = #{userId}
                UNION
                SELECT
                gv.vehicle_id AS vehId
                FROM
                sys_group_vehicle_lk gv
                INNER JOIN sys_group_user_lk gu ON gu.group_id = gv.group_id
                WHERE
                GU.USER_ID = #{userId}
                ) pow ON veh.id = pow.vehId WHERE 1 = 1
            </when>
            <when test=" isLeader != null and isLeader == 1 and areaPath != '/0/' and unitTypeCode == '0001' ">
                LEFT JOIN sys_area sa ON sa.id = veh.sys_division_id
                LEFT JOIN sys_unit mu ON mu.id = veh.manu_unit_id
                WHERE
                mu.path LIKE CONCAT ('%', #{userUnitPath} ,'%')
                AND sa.path LIKE CONCAT ('%', #{areaPath} ,'%')
            </when>
            <when test=" isLeader != null and isLeader == 1 and areaPath != '/0/' and unitTypeCode != '0001' ">
                LEFT JOIN sys_area sa ON sa.id = veh.sys_division_id
                LEFT JOIN sys_unit uu ON uu.id = veh.use_uint_id
                WHERE
                uu.path LIKE CONCAT ('%', #{userUnitPath} ,'%')
                AND
                sa.path LIKE CONCAT ('%', #{areaPath} ,'%')
            </when>
            <when test=" isLeader != null and isLeader == 1 and areaPath == '/0/' and unitTypeCode == '0001' ">
                LEFT JOIN sys_unit mu ON mu.id = veh.manu_unit_id
                WHERE
                mu.path LIKE CONCAT ('%', #{userUnitPath} ,'%')
            </when>
            <when test=" isLeader != null and isLeader == 1 and areaPath == '/0/' and unitTypeCode != '0001' ">
                SELECT
                *
                FROM
                sys_vehicle veh
                LEFT JOIN sys_unit uu ON uu.id = veh.use_uint_id
                WHERE
                uu.path LIKE CONCAT ('%', #{userUnitPath} ,'%')
            </when>
            <when test=" isLeader != null and isLeader == 2 and areaPath != '/0/' ">
                LEFT JOIN sys_area sa ON sa.id = veh.sys_division_id
                WHERE
                sa.path LIKE CONCAT ('%', #{areaPath} ,'%')
            </when>
            <when test=" isLeader != null and isLeader == 2 and areaPath == '/0/' ">
                WHERE 1 = 1
            </when>
            <otherwise>
                WHERE 1 != 1
            </otherwise>
        </choose>
    </sql>
</mapper>